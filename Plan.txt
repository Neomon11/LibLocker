1. Общее описание
Система предназначена для централизованного контроля, учета времени использования и дистанционного управления компьютерами в локальной сети. Состоит из серверного приложения (Панель администратора) и клиентского приложения (Агент), устанавливаемого на подконтрольные ПК.

2. Функциональные требования к Серверному приложению (Панель администратора)

2.1. Управление клиентами и идентификация

Вести базу данных всех подключенных клиентов с уникальными идентификаторами (на основе HWID, MAC-адреса или комбинации параметров).

Автоматически распознавать переподключившиеся ранее компьютеры по их уникальному ID.

Отображать список клиентов с информацией о статусе (онлайн/оффлайн, активна сессия), имени ПК, IP-адресе.

2.2. Управление сессиями

Дистанционное создание сессии для выбранного клиента:

Быстрые кнопки: «+30 минут», «Безлимит».

Диалог для установки произвольного времени (часы/минуты).

Отображение на сервере оставшегося времени сессии для каждого активного клиента в режиме реального времени.

Функция отправки команды на принудительное разблокирование экрана клиента (окончание сессии досрочно).

Функция отправки команды на дистанционное выключение компьютера клиента.

2.3. Учет и тарификация

Вести детальную статистику по всем сессиям с привязкой к клиенту, дате, продолжительности.

Формировать сводные отчеты: ежедневные и помесячные.

Настраиваемая тарификация:

Поле для ввода стоимости сессии (руб./час).

Настройка правила округления продолжительности сессии (например, до 5, 10, 15 минут).

Переключатель «Бесплатный режим» для отключения расчета стоимости.

Автоматический расчет стоимости каждой сессии на основе продолжительности, тарифа и правил округления.

Экспорт любого отчета в файл формата PDF.

2.4. Интерфейс и настройки

Современный, интуитивно понятный графический интерфейс (GUI).

Наличие меню/раздела «Настройки» для конфигурации:

Параметры сети (порт для подключений).

Параметры тарификации.

Настройки безопасности (пароль администратора и т.д.).

2.5. Сетевое взаимодействие и дополнительные функции

Поддерживать постоянное соединение с клиентами (long-lived connection).

Автоматически пытаться восстановить соединение с клиентом при его разрыве.

Иметь встроенный веб-сервер для доступа к панели управления через браузер по локальной сети (в т.ч. со смартфонов и планшетов). Веб-интерфейс должен предоставлять ключевые функции управления сессиями и просмотра статистики.

3. Функциональные требования к Клиентскому приложению (Агент)

3.1. Основная функциональность

Автоматический запуск при загрузке Windows (регистрация в автозагрузке).

Установка и поддержание постоянного соединения с сервером. Автоподключение при разрыве.

Получение и выполнение команд с сервера: начало/окончание сессии, выключение ПК.

3.2. Блокировка и интерфейс

При получении команды на начало сессии:

Переходить в режим блокировки, отображая поверх всех окон (Always on Top) полноэкранное не закрываемое пользователем окно.

На окне блокировки отображать:

Таймер с обратным отсчетом времени до конца сессии.

Рассчитанную стоимость сессии (если режим не бесплатный).

Информационное сообщение.

В незаблокированном состоянии (при ожидании команды) работать в свернутом виде, с возможностью вывода поверх всех окон небольшого компактного таймера (виджета) с оставшимся временем. Виджет должен иметь кнопку временного скрытия.

3.3. Защита от несанкционированного прекращения работы

Защита от закрытия:

Отключение обработчика кнопки «Закрыть» (крестик) в окне.

Скрытие окна из панели задач (Taskbar) и диспетчера задач (Windows Task Manager) — работа в режиме служебного процесса или с кастомным именем.

Игнорирование «опасных» глобальных горячих клавиш (Alt+F4, Ctrl+Alt+Del* — ограниченно) во время блокировки.

Защита окна блокировки:

Окно должно быть поверх всех окон (Topmost), полноэкранным.

Запрет на переключение между приложениями (Alt+Tab), закрытие и минимизацию.

Законные способы отключения клиента или окна блокировки:

Команда с сервера.

Ввод секретного пароля администратора в специальное скрытое поле на окне блокировки (например, по двойному клику в углу).

Автоматическое снятие блокировки при невозможности подключения к серверу в течение заданного времени (таймаут), если это предусмотрено логикой.

3.4. Автономный режим

При отсутствии соединения с сервером переходить в автономный режим.

В автономном режиме предоставлять локальный интерфейс для ручного создания и контроля сессии с аналогичными функциями блокировки и защиты.

Локально вести журнал сессий для последующей синхронизации с сервером при восстановлении связи.

4. Общие нефункциональные требования

Платформа: Оба приложения (клиент и сервер) должны быть скомпилированы под Windows (x64/x86).

Защита: Клиентское приложение должно быть защищено от закрытия через командную строку (например, через taskkill /im). Рекомендуемые методы: работа в качестве службы (Windows Service) или использование драйвер-фильтра для защиты процесса.

Надежность соединения: Устойчивость к кратковременным сбоям сети. Механизм keep-alive и переподключения.

Интерфейс: Современный, лаконичный, удобный для ежедневного использования интерфейс в стиле Windows приложений (можно использовать актуальные фреймворки: WPF, WinUI 3 и т.д.).

Безопасность: Пароли администратора должны храниться в хешированном виде. Сетевой трафик между клиентом и сервером желательно шифровать (даже в локальной сети).

Рекомендации к технической реализации для разработчика:
Протокол связи: Использовать стабильный протокол (например, WebSocket для постоянного соединения или gRPC), а не сырые сокеты, для упрощения обработки разрывов и сериализации данных.

Клиент как служба: Сильно усложняет закрытие через Диспетчер задач, но требует прав администратора для установки/удаления. Можно сделать два варианта установки: фоновое приложение (файл .exe) и служба.

Защита процесса: Для защиты от taskkill рассмотреть использование драйвера (с подписью) или методы Process.EnterDebugMode() с последующим снятием прав PROCESS_TERMINATE. Важно: Это повышает сложность и может требовать подписывания кода/драйвера.

Уникальный ID: Использовать стабильный идентификатор, например, GetSystemFingerprint() на основе серийных номеров диска, материнской платы, MAC-адреса.

Веб-сервер: Встроить легковесную библиотеку (например, ASP.NET Core Kestrel) или использовать готовые решения для встраивания (EmbedIO).