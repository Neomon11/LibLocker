# Исправление ошибки дублирующихся секций и добавление серверной конфигурации модуля мониторинга установки программ

## Проблемы, которые были решены

1. **Ошибка DuplicateSectionError**: Исправлена ошибка `configparser.DuplicateSectionError` при загрузке `config.client.ini`, которая возникала из-за дублирующейся секции `[installation_monitor]`.

2. **Синхронизация настроек мониторинга установки программ**: Добавлена возможность управления настройками модуля мониторинга установки программ с сервера, которые синхронизируются на всех клиентах.

## Внесенные изменения

### 1. Исправление конфигурационных файлов

- **config.client.ini**: Пересоздан из `config.client.example.ini` для устранения дублирования секций
- **config.ini** и **config.example.ini**: Добавлена секция `[installation_monitor]` с параметрами:
  - `enabled` - включить мониторинг по умолчанию (false)
  - `alert_volume` - громкость сирены (0-100, по умолчанию 80)

### 2. Обновление конфигурационных классов (src/shared/config.py)

Добавлены свойства в класс `ServerConfig`:
- `installation_monitor_enabled` - чтение/запись состояния включения мониторинга
- `installation_monitor_alert_volume` - чтение/запись громкости сирены

### 3. Обновление протокола (src/shared/protocol.py)

Класс `InstallationMonitorToggleMessage` теперь включает:
- `enabled` - состояние включения/выключения
- `alert_volume` - громкость сирены (новое поле)

### 4. Серверная часть (src/server/server.py)

- Конструктор `LibLockerServer` теперь принимает параметр `config`
- Метод `toggle_installation_monitor()` использует настройки из серверной конфигурации и передает их клиенту

### 5. Серверный GUI (src/server/gui.py)

Добавлена новая группа настроек "Модуль антиустановки" во вкладке настроек:
- Чекбокс "Включить мониторинг установки программ по умолчанию"
- Поле ввода "Громкость сирены" (0-100%)
- Настройки сохраняются и загружаются вместе с остальными настройками сервера

### 6. Клиентская часть (src/client/client.py и src/client/gui.py)

- Обработчик `_handle_installation_monitor_toggle()` теперь принимает и обрабатывает `alert_volume`
- Сигнал `installation_monitor_toggle` обновлен для передачи двух параметров: `enabled` и `alert_volume`
- При получении команды от сервера, клиент:
  1. Сохраняет настройки в локальный конфиг
  2. Применяет настройки к модулю мониторинга

## Как использовать

### На сервере:

1. Откройте серверное приложение LibLocker
2. Перейдите во вкладку "Настройки"
3. Найдите секцию "Модуль мониторинга установки программ"
4. Настройте:
   - Включение мониторинга по умолчанию
   - Громкость сирены (0-100%)
5. Нажмите "Сохранить настройки"
6. При включении/выключении мониторинга для конкретного клиента через кнопку в таблице клиентов, будут использоваться настройки с сервера

### На клиенте:

- Клиент автоматически получает и применяет настройки от сервера
- При обнаружении установки будет использоваться громкость, заданная на сервере
- Настройки сохраняются локально в `config.client.ini`

## Тестирование

Создан тестовый скрипт `test_server_config_sync.py`, который проверяет:
- Загрузку серверной конфигурации
- Загрузку клиентской конфигурации
- Корректность протокола передачи настроек
- Сохранение и перезагрузку настроек

Запуск теста:
```bash
python3 test_server_config_sync.py
```

## Технические детали

### Потоки данных:

1. **Сервер → Клиент**:
   - Сервер читает настройки из `config.ini` секция `[installation_monitor]`
   - При переключении мониторинга отправляет команду `INSTALLATION_MONITOR_TOGGLE` с параметрами `enabled` и `alert_volume`
   - Клиент получает команду и применяет настройки

2. **Хранение на клиенте**:
   - Настройки сохраняются в `config.client.ini` секция `[installation_monitor]`
   - При перезапуске клиента используются последние полученные настройки

### Обратная совместимость:

- Если `alert_volume` не указан в сообщении, используется значение по умолчанию 80
- Старые конфигурационные файлы будут обновлены при первом сохранении настроек
