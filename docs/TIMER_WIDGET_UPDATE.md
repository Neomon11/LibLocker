# Обновление функциональности - Виджет таймера

## Изменения в версии

### Новая логика работы клиента

**Изменена последовательность отображения элементов интерфейса:**

#### 1. Во время сессии
- Показывается **компактный виджет-таймер** в левом верхнем углу экрана
- Виджет отображает:
  - Оставшееся время (чч:мм:сс)
  - Стоимость сессии (если не бесплатная)
- Виджет можно **скрыть/свернуть** нажатием кнопки "×"
  - В свернутом состоянии показывается только иконка "⏱"
- Виджет всегда поверх других окон
- Полупрозрачный темный фон с закругленными углами

#### 2. После окончания времени сессии
- Автоматически показывается **полноэкранная блокировка**
- Блокировка показывает:
  - Сообщение "Время сессии истекло"
  - Итоговую стоимость сессии
  - Инструкции для разблокировки
- Блокировку невозможно закрыть без пароля администратора

#### 3. Безлимитные сессии
- Таймер показывает ∞ и прошедшее время
- Блокировка НЕ включается автоматически
- Блокировка включается только по команде сервера (остановка сессии)

### Преимущества новой логики

✅ **Не мешает работе** - пользователь может работать свободно во время оплаченной сессии

✅ **Визуальный контроль** - всегда видно оставшееся время

✅ **Гибкость** - виджет можно свернуть если мешает

✅ **Честность** - блокировка включается только после истечения оплаченного времени

✅ **Мотивация** - пользователь видит, что время заканчивается и может продлить сессию заранее

### Технические детали

#### Класс TimerWidget
```python
- Компактный размер: 200x100 пикселей (полный) / 50x30 (свернутый)
- Позиция: левый верхний угол (20, 20)
- Обновление каждую секунду
- Сигнал session_finished при окончании времени
- Поддержка unlimited сессий
```

#### Класс LockScreen
```python
- Полноэкранный режим
- Показывается ПОСЛЕ окончания времени
- Отображает итоговую стоимость
- Разблокировка через тройной клик + пароль
- Защита от закрытия
```

#### Класс MainClientWindow
```python
- Управляет переключением между виджетом и блокировкой
- Слушает сигнал session_finished от виджета
- Показывает блокировку при окончании времени
- Обрабатывает команды остановки от сервера
```

### Примеры использования

**Сценарий 1: Оплачена сессия на 30 минут**
1. Клиент получает команду начала сессии
2. Появляется виджет с таймером 00:30:00
3. Таймер отсчитывает время
4. Через 30 минут показывается блокировка
5. Пользователь идет к администратору для оплаты

**Сценарий 2: Безлимитная сессия**
1. Клиент получает команду начала безлимитной сессии
2. Появляется виджет с таймером ∞ 00:00:00
3. Таймер показывает прошедшее время
4. Блокировка НЕ включается автоматически
5. Администратор вручную останавливает сессию с сервера
6. Показывается блокировка с итоговой стоимостью

**Сценарий 3: Досрочная остановка**
1. Во время сессии администратор отправляет команду остановки
2. Виджет закрывается
3. Возвращается обычный режим (без блокировки)

### Настройка внешнего вида

Виджет таймера можно кастомизировать через CSS в коде:
```python
self.setStyleSheet("""
    QWidget {
        background-color: rgba(40, 40, 40, 240);
        color: white;
        border-radius: 10px;
    }
""")
```

### Совместимость

- ✅ Windows 10/11
- ✅ Python 3.12+
- ✅ PyQt6 6.6.1
- ✅ Работает со всеми функциями сервера

### Миграция с предыдущей версии

Изменения обратно совместимы. Серверная часть не требует изменений.
Клиент автоматически использует новую логику при получении команд от сервера.

