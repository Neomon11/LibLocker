# Руководство пользователя LibLocker

## Содержание
1. [Серверное приложение](#серверное-приложение)
2. [Клиентское приложение](#клиентское-приложение)
3. [Типичные сценарии использования](#типичные-сценарии-использования)

## Серверное приложение

### Главное окно

После запуска `run_server.py` откроется главное окно панели администратора с тремя вкладками:

#### Вкладка "Клиенты"

Отображает список всех зарегистрированных клиентов:
- **ID** - уникальный идентификатор клиента в БД
- **Имя** - имя компьютера
- **IP** - IP-адрес в локальной сети
- **Статус** - текущий статус (Offline/Online/In Session)
- **Время сессии** - оставшееся время активной сессии
- **Действия** - быстрые действия для клиента

**Кнопки управления:**
- **Начать сессию** - создание новой сессии для выбранного клиента
- **Остановить сессию** - принудительное завершение активной сессии
- **Выключить ПК** - дистанционное выключение компьютера клиента

#### Вкладка "Статистика"

Показывает историю всех сессий:
- ID сессии
- Имя клиента
- Время начала и окончания
- Фактическая длительность
- Рассчитанная стоимость

**Кнопки:**
- **Экспорт в PDF** - сохранение отчета в PDF-файл (в разработке)

#### Вкладка "Настройки"

**Тарификация:**
- **Бесплатный режим** - если включен, стоимость не рассчитывается
- **Стоимость** - тариф в рублях за час использования
- **Округление** - округление времени сессии (в минутах)

**Сетевые настройки:**
- **Порт** - порт WebSocket сервера (по умолчанию 8765)
- **Веб-порт** - порт веб-интерфейса (по умолчанию 8080)

### Создание сессии

1. Выберите клиента в таблице
2. Нажмите "Начать сессию"
3. В открывшемся диалоге выберите:
   - **+30 минут** - быстрое добавление 30 минут
   - **Безлимит** - сессия без ограничения по времени
   - **Произвольное время** - укажите часы и минуты вручную
4. Нажмите "Создать"

На клиентском компьютере появится окно блокировки с таймером.

### Остановка сессии

1. Выберите клиента с активной сессией
2. Нажмите "Остановить сессию"

Окно блокировки на клиенте закроется, сессия будет сохранена в базу данных.

## Клиентское приложение

### Запуск

Клиентское приложение запускается командой:
```bash
python run_client.py http://<IP-адрес-сервера>:8765
```

Например:
```bash
python run_client.py http://192.168.1.10:8765
```

### Режимы работы

#### Ожидание (минимизированный режим)

После запуска клиент подключается к серверу и ждет команд. В этом режиме:
- Приложение свернуто
- Соединение с сервером поддерживается автоматически
- Отправляются heartbeat-сообщения каждые 5 секунд

#### Режим блокировки (активная сессия)

При получении команды начала сессии:
- Открывается полноэкранное окно блокировки
- Окно всегда поверх других окон
- Отображается:
  - Таймер обратного отсчета
  - Стоимость сессии (если не бесплатный режим)
  - Информационное сообщение

**Защита:**
- Окно нельзя закрыть стандартными способами
- Заблокированы горячие клавиши Alt+F4, Escape
- Невозможно переключиться на другие приложения (частично)

### Разблокировка администратором

Для экстренной разблокировки:
1. Кликните 3 раза в правом верхнем углу окна блокировки
2. Появится поле ввода пароля
3. Введите пароль администратора (по умолчанию: "admin" для отладки)
4. Нажмите OK

**Важно:** В production-версии установите надежный пароль!

### Автономный режим

Если клиент теряет связь с сервером:
- Активная сессия продолжается локально
- Данные сохраняются в локальный журнал
- При восстановлении связи данные синхронизируются с сервером

## Типичные сценарии использования

### Сценарий 1: Компьютерный клуб

**Задача:** Клиент хочет поиграть 2 часа

1. Администратор выбирает компьютер клиента в панели
2. Нажимает "Начать сессию"
3. Выбирает 2 часа (120 минут)
4. На компьютере клиента появляется окно с таймером
5. Через 2 часа окно автоматически закрывается
6. В статистике сохраняется запись о сессии с рассчитанной стоимостью

### Сценарий 2: Библиотека

**Задача:** Предоставить бесплатный доступ на 30 минут

1. В настройках включен "Бесплатный режим"
2. Администратор выбирает компьютер
3. Нажимает "Начать сессию" → "+30 минут"
4. Клиент получает 30 минут без оплаты
5. Статистика записывается без стоимости

### Сценарий 3: Учебный класс

**Задача:** Занятия с 9:00 до 12:00

1. Администратор создает безлимитные сессии для всех компьютеров
2. Ученики работают без ограничения по времени
3. В 12:00 администратор вручную останавливает все сессии
4. Или отправляет команду выключения всех компьютеров

### Сценарий 4: Экстренная остановка

**Задача:** Нужно срочно освободить компьютер

**Вариант 1 - с сервера:**
1. Администратор выбирает клиента
2. Нажимает "Остановить сессию"
3. Окно блокировки закрывается немедленно

**Вариант 2 - локально:**
1. На компьютере клиента кликаем 3 раза в углу
2. Вводим пароль администратора
3. Окно закрывается

## Советы и рекомендации

### Для администраторов

1. **Регулярно проверяйте статистику** - это поможет отследить использование
2. **Настройте тарификацию** перед началом работы
3. **Создайте резервные копии** базы данных (файл `data/liblocker.db`)
4. **Установите надежный пароль администратора**

### Для клиентов

1. **Не пытайтесь обойти блокировку** - это может привести к проблемам
2. **Следите за таймером** - знайте, сколько времени осталось
3. **При проблемах обращайтесь к администратору**

### Безопасность

1. **Измените пароль администратора** в production
2. **Ограничьте доступ к серверу** - используйте firewall
3. **Регулярно обновляйте** систему
4. **Проверяйте логи** на наличие подозрительной активности

## Устранение неполадок

### Клиент не подключается к серверу

**Причины:**
- Сервер не запущен
- Неправильный IP-адрес
- Заблокирован firewall

**Решение:**
1. Проверьте, что сервер запущен
2. Проверьте IP-адрес командой `ipconfig` на сервере
3. Откройте порт 8765 в firewall

### Окно блокировки закрывается

**Причины:**
- Недостаточно прав (нужен администратор)
- Конфликт с другим ПО

**Решение:**
1. Запустите клиент от имени администратора
2. Отключите конфликтующее ПО

### Статистика не сохраняется

**Причины:**
- Проблемы с базой данных
- Недостаточно прав на запись

**Решение:**
1. Проверьте папку `data/`
2. Дайте права на запись
3. Перезапустите сервер

## Контакты и поддержка

При возникновении проблем:
1. Проверьте документацию `README.md`
2. Изучите логи в папке `logs/`
3. Создайте Issue в репозитории проекта

